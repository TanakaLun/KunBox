# VPN é€šçŸ¥å£°éŸ³é—®é¢˜è§£å†³æŒ‡å—

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šå¼€å¯ VPN åæŒç»­æ”¶åˆ°å¸¦å£°éŸ³çš„é€šçŸ¥ï¼Œåªæœ‰å…³é—­ "Allow notifications" æ‰èƒ½åœæ­¢ï¼Œä½†è¿™æ ·ä¼šå¯¼è‡´ VPN æœåŠ¡æ— æ³•æ­£å¸¸è¿è¡Œã€‚

## æ ¹æœ¬åŸå› 

1. **Android ç³»ç»Ÿè¦æ±‚**ï¼šVPN æœåŠ¡å¿…é¡»ä½œä¸ºå‰å°æœåŠ¡è¿è¡Œï¼Œå‰å°æœåŠ¡å¿…é¡»æ˜¾ç¤ºæŒä¹…é€šçŸ¥ï¼ˆè¿™æ˜¯ç³»ç»Ÿå®‰å…¨æœºåˆ¶ï¼Œæ— æ³•ç»•è¿‡ï¼‰

2. **é€šçŸ¥æ¸ é“è¦†ç›–**ï¼šè™½ç„¶åº”ç”¨ä»£ç ä¸­å·²å°†é€šçŸ¥æ¸ é“è®¾ç½®ä¸º `IMPORTANCE_LOW`ï¼ˆé™éŸ³æ¨¡å¼ï¼‰ï¼Œä½†ç”¨æˆ·å¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®ä¸­æ‰‹åŠ¨ä¿®æ”¹é€šçŸ¥æ¸ é“çš„å£°éŸ³/æŒ¯åŠ¨é…ç½®ï¼Œè¿™äº›ä¿®æ”¹ä¼šè¦†ç›–åº”ç”¨çš„é»˜è®¤è®¾ç½®

3. **å½“å‰çŠ¶æ€**ï¼šç”¨æˆ·çš„ "KunBox VPN" é€šçŸ¥æ¸ é“è¢«è®¾ç½®ä¸º "Default ringtone (Bongo)" + "Sound" å¼€å¯ï¼Œå¯¼è‡´æ¯æ¬¡ VPN çŠ¶æ€æ›´æ–°æ—¶éƒ½ä¼šæ’­æ”¾æç¤ºéŸ³

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šç”¨æˆ·æ‰‹åŠ¨é…ç½®ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰

**æ­¥éª¤ï¼š**

1. æ‰“å¼€ç³»ç»Ÿè®¾ç½® â†’ åº”ç”¨ â†’ KunBox â†’ é€šçŸ¥
2. ç‚¹å‡» "KunBox VPN" é€šçŸ¥ç±»å‹
3. è¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼š
   - âœ… **ä¿æŒ "Allow notifications" å¼€å¯**ï¼ˆå¿…éœ€ï¼Œå…³é—­ä¼šå¯¼è‡´ VPN æ— æ³•è¿è¡Œï¼‰
   - âœ… **å¼€å¯ "Gentle notifications"**ï¼ˆé™é»˜é€šçŸ¥ï¼Œä¸æ˜¾ç¤ºæ¨ªå¹…å’Œæç¤ºéŸ³ï¼‰
   - âŒ å…³é—­ "Banners"ï¼ˆä¸åœ¨çŠ¶æ€æ é¡¶éƒ¨å¼¹å‡ºï¼‰
   - âŒ å°† "Sound" è®¾ç½®ä¸º "None"ï¼ˆé™éŸ³ï¼‰
   - âŒ å…³é—­ "Vibration"ï¼ˆä¸æŒ¯åŠ¨ï¼‰
   - ğŸ“± "Lock screen notifications" å¯è®¾ç½®ä¸º "Don't show"ï¼ˆä¸åœ¨é”å±æ˜¾ç¤ºï¼‰

**æ•ˆæœï¼š** é€šçŸ¥ä»ç„¶å­˜åœ¨ï¼ˆVPN è¿è¡Œæ‰€å¿…éœ€ï¼‰ï¼Œä½†å®Œå…¨é™é»˜ï¼Œåªåœ¨é€šçŸ¥æ æ˜¾ç¤ºå°å›¾æ ‡

### æ–¹æ¡ˆ 2ï¼šä»£ç ä¼˜åŒ–ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰

åœ¨åº”ç”¨ä¸­æ·»åŠ "é€šçŸ¥è®¾ç½®å¼•å¯¼"åŠŸèƒ½ï¼š

1. **æ£€æµ‹ç”¨æˆ·é€šçŸ¥é…ç½®**
   - åœ¨ VPN é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œæ£€æµ‹ "KunBox VPN" é€šçŸ¥æ¸ é“æ˜¯å¦å¯ç”¨äº†å£°éŸ³/æŒ¯åŠ¨
   - å¦‚æœæ£€æµ‹åˆ°ç”¨æˆ·é…ç½®äº†å£°éŸ³ï¼Œæ˜¾ç¤ºå¼•å¯¼å¯¹è¯æ¡†

2. **ä¸€é”®è·³è½¬ç³»ç»Ÿè®¾ç½®**
   - æä¾›"ä¼˜åŒ–é€šçŸ¥è®¾ç½®"æŒ‰é’®ï¼Œç›´æ¥è·³è½¬åˆ°é€šçŸ¥æ¸ é“è®¾ç½®é¡µé¢
   - æ˜¾ç¤ºæ¨èé…ç½®æ¸…å•ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰

3. **è‡ªåŠ¨é‡ç½®é€šçŸ¥æ¸ é“**
   - æä¾›"é‡ç½®ä¸ºé™é»˜æ¨¡å¼"é€‰é¡¹
   - åˆ é™¤ç°æœ‰é€šçŸ¥æ¸ é“ï¼Œé‡æ–°åˆ›å»ºä¸º `IMPORTANCE_LOW`
   - æ³¨æ„ï¼šAndroid 8.0+ ä¸­ï¼Œç”¨æˆ·ä¿®æ”¹åçš„æ¸ é“è®¾ç½®ä¼˜å…ˆçº§é«˜äºåº”ç”¨é»˜è®¤è®¾ç½®ï¼Œéœ€è¦åˆ é™¤é‡å»º

### æ–¹æ¡ˆ 3ï¼šSingBox Proxy é€šçŸ¥ï¼ˆå·²å®ç°ï¼‰

å¯¹äºä¸éœ€è¦å‰å°æœåŠ¡çš„çŠ¶æ€æç¤ºï¼Œä½¿ç”¨ "SingBox Proxy" é€šçŸ¥æ¸ é“ï¼ˆGentle notificationsï¼‰ï¼Œè¿™ä¸ªæ¸ é“æœ¬èº«å°±æ˜¯é™é»˜çš„ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©æ€§å…³é—­ã€‚

## æŠ€æœ¯è¯´æ˜

### å½“å‰ä»£ç å®ç°

```kotlin
// SingBoxService.kt:2933
private fun createNotificationChannel() {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
        val channel = NotificationChannel(
            CHANNEL_ID,
            "KunBox VPN",
            NotificationManager.IMPORTANCE_LOW // é™éŸ³é€šçŸ¥
        ).apply {
            description = "VPN Service Notification"
            setShowBadge(false) // ä¸æ˜¾ç¤ºè§’æ ‡
            enableVibration(false) // ç¦ç”¨æŒ¯åŠ¨
            enableLights(false) // ç¦ç”¨æŒ‡ç¤ºç¯
            setSound(null, null) // æ˜¾å¼ç¦ç”¨å£°éŸ³
            lockscreenVisibility = Notification.VISIBILITY_PUBLIC
        }
        manager.createNotificationChannel(channel)
    }
}
```

### Android é€šçŸ¥æ¸ é“ä¼˜å…ˆçº§

1. **é¦–æ¬¡åˆ›å»º**ï¼šåº”ç”¨è®¾ç½® `IMPORTANCE_LOW` + `setSound(null, null)`
2. **ç”¨æˆ·ä¿®æ”¹**ï¼šç”¨æˆ·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­ä¿®æ”¹ä¸º "Default ringtone"
3. **ä¼˜å…ˆçº§**ï¼šç”¨æˆ·ä¿®æ”¹ > åº”ç”¨é»˜è®¤è®¾ç½®ï¼ˆAndroid 8.0+ è®¾è®¡å¦‚æ­¤ï¼‰
4. **é‡ç½®æ–¹æ³•**ï¼šåˆ é™¤æ¸ é“ â†’ é‡æ–°åˆ›å»ºï¼ˆä½†ä¼šä¸¢å¤±ç”¨æˆ·å…¶ä»–åå¥½è®¾ç½®ï¼‰

### åä¸ºè®¾å¤‡ç‰¹æ®Šå¤„ç†

ä»£ç ä¸­å·²é’ˆå¯¹åä¸º EMUI ç³»ç»Ÿåšäº†ä¼˜åŒ–ï¼š

```kotlin
// SingBoxService.kt:2970
// BUGä¿®å¤(åä¸ºè®¾å¤‡): é¿å…é¢‘ç¹è°ƒç”¨ startForeground() è§¦å‘ç³»ç»Ÿæç¤ºéŸ³
// åŸå› : åä¸ºEMUIç­‰ç³»ç»Ÿåœ¨æ¯æ¬¡ startForeground() è°ƒç”¨æ—¶å¯èƒ½æ’­æ”¾æç¤ºéŸ³
// è§£å†³: åªåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è°ƒç”¨ startForeground(),åç»­ä½¿ç”¨ NotificationManager.notify() æ›´æ–°
```

## æ¨èæ–¹æ¡ˆ

**çŸ­æœŸæ–¹æ¡ˆ**ï¼šå¼•å¯¼ç”¨æˆ·æ‰‹åŠ¨é…ç½®é€šçŸ¥è®¾ç½®ï¼ˆæ–¹æ¡ˆ 1ï¼‰

**é•¿æœŸæ–¹æ¡ˆ**ï¼šå®ç°æ–¹æ¡ˆ 2ï¼Œåœ¨åº”ç”¨å†…æä¾›é€šçŸ¥è®¾ç½®å¼•å¯¼å’Œä¸€é”®è·³è½¬åŠŸèƒ½

## å‚è€ƒèµ„æ–™

- [Android Foreground Services](https://developer.android.com/guide/components/foreground-services)
- [Notification Channels](https://developer.android.com/develop/ui/views/notifications/channels)
- [VpnService Documentation](https://developer.android.com/reference/android/net/VpnService)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-09
**ç›¸å…³æ–‡ä»¶**: `app/src/main/java/com/kunk/singbox/service/SingBoxService.kt:2933-2957`
